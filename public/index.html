<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Diary For Kh√°nh Trang</title>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

body{
  margin:0;
  background:#ffe6f0;
  font-family:'Patrick Hand', cursive;
}

.app{
  min-height:100vh;
  position:relative;
}

/* ===== HEADER ===== */

.header{
  padding:24px 24px 6px 24px;
  font-size:34px;
  color:#ff4d94;
}

.un-header{
  padding:0 24px 20px 24px;
  font-size:18px;
  color:#ff85b3;
  font-style:italic;
  opacity:.9;
}

/* ===== GRID ===== */

.grid{
  padding:0 24px 30px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:20px;
}

.card{
  height:180px;
  background:white;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(255,105,180,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:10px;
  font-size:18px;
  cursor:pointer;
  transition:.25s;
  position:relative;
}

.card:hover{
  transform:translateY(-5px);
}

.card.add{
  font-size:40px;
  color:#ff4d94;
}

/* delete icon */
.delete-btn{
  position:absolute;
  top:8px;
  left:8px;
  background:#ff4d94;
  color:white;
  border:none;
  width:26px;
  height:26px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  opacity:0;
  transition:.2s;
}

.card:hover .delete-btn{
  opacity:1;
}

/* ===== DETAIL VIEW ===== */

.detail{
  position:fixed;
  inset:0;
  background:white;
  padding:24px;
  opacity:0;
  transform:scale(.95);
  pointer-events:none;
  transition:.3s;
  overflow-y:auto;
}

.detail.active{
  opacity:1;
  transform:scale(1);
  pointer-events:auto;
}

.top-actions{
  display:flex;
  gap:20px;
  margin-bottom:20px;
}

.back,
.delete-text{
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
}

.back{color:#ff4d94;}
.delete-text{color:#ff1a75;}

h2{
  margin:10px 0 8px;
}

input, textarea{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:2px solid #ffd1e8;
  font-family:inherit;
  font-size:28px;
  margin-bottom:20px;
}

textarea{
  min-height:260px;
  resize:none;
  overflow:hidden;
}

.save-btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:999px;
  background:#ff4d94;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* ===== MODAL ===== */

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
}

.modal.active{
  opacity:1;
  pointer-events:auto;
}

.modal-box{
  background:white;
  padding:25px;
  border-radius:20px;
  width:85%;
  max-width:320px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
}

.modal-buttons{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:20px;
  flex-wrap:wrap;
}

.modal-buttons button{
  padding:10px 16px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  font-family:inherit;
}

.btn-primary{background:#ff4d94;color:white;}
.btn-secondary{background:#ddd;}
.btn-danger{background:#ff1a75;color:white;}

/* ===== MOBILE OPTIMIZE ===== */

@media (max-width:768px){

  .header{font-size:26px;}
  .un-header{font-size:16px;}

  .grid{
    grid-template-columns:repeat(2,1fr);
    gap:16px;
  }

  .card{
    height:150px;
    font-size:16px;
  }
}
</style>
</head>

<body>
<div class="app">
  <div class="header">üìñ Diary For Kh√°nh Trang</div>
  <div class="un-header">N∆°i l∆∞u gi·ªØ nh·ªØng d√≤ng k·ªâ ni·ªám hai ta</div>

  <div class="grid" id="grid"></div>

  <div class="detail" id="detail">
    <div class="top-actions">
      <button class="back">‚Üê Back</button>
      <button class="delete-text" id="deleteDetailBtn">Delete</button>
    </div>

    <h2>Title</h2>
    <input id="titleInput">

    <h2>N·ªôi dung</h2>
    <textarea id="noteInput"></textarea>

    <button class="save-btn" id="saveBtn">üíæ Save</button>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div id="modalMessage"></div>
    <div class="modal-buttons" id="modalButtons"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore,collection,addDoc,doc,updateDoc,deleteDoc,onSnapshot }
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"lovechip-14-2.firebaseapp.com",
  projectId:"lovechip-14-2",
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const notesRef=collection(db,"notes");

const grid=document.getElementById("grid");
const detail=document.getElementById("detail");
const titleInput=document.getElementById("titleInput");
const noteInput=document.getElementById("noteInput");
const backBtn=document.querySelector(".back");
const saveBtn=document.getElementById("saveBtn");
const deleteDetailBtn=document.getElementById("deleteDetailBtn");

const modal=document.getElementById("modal");
const modalMessage=document.getElementById("modalMessage");
const modalButtons=document.getElementById("modalButtons");

let currentId=null;
let originalTitle="",originalContent="";

function showModal(message,buttons){
  modalMessage.textContent=message;
  modalButtons.innerHTML="";
  buttons.forEach(btn=>{
    const b=document.createElement("button");
    b.textContent=btn.text;
    b.className=btn.class;
    b.onclick=()=>{modal.classList.remove("active");btn.onClick();}
    modalButtons.appendChild(b);
  });
  modal.classList.add("active");
}

onSnapshot(notesRef,snapshot=>{
  grid.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const div=document.createElement("div");
    div.className="card";
    div.textContent=data.title||"No Title";

    const del=document.createElement("button");
    del.className="delete-btn";
    del.textContent="√ó";
    del.onclick=(e)=>{
      e.stopPropagation();
      showModal("Xo√° ghi ch√∫ n√†y?",[
        {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
        {text:"Xo√°",class:"btn-danger",onClick:()=>deleteDoc(doc(db,"notes",docSnap.id))}
      ]);
    };
    div.appendChild(del);

    div.onclick=()=>{
      currentId=docSnap.id;
      titleInput.value=data.title||"";
      setTimeout(()=>autoResize(noteInput),0);
      noteInput.value=data.content||"";
      originalTitle=titleInput.value;
      originalContent=noteInput.value;
      openDetail();
    };

    grid.appendChild(div);
  });

  const add=document.createElement("div");
  add.className="card add";
  add.textContent="+";
  add.onclick=createNote;
  grid.appendChild(add);
});

async function createNote(){
  const docRef=await addDoc(notesRef,{title:"New Note",content:""});
  currentId=docRef.id;
  titleInput.value="New Note";
  noteInput.value="";
  originalTitle="New Note";
  originalContent="";
  openDetail();
}

async function saveNote(){
  if(!currentId) return;
  await updateDoc(doc(db,"notes",currentId),{
    title:titleInput.value,
    content:noteInput.value
  });
  originalTitle=titleInput.value;
  originalContent=noteInput.value;
  showModal("ƒê√£ l∆∞u th√†nh c√¥ng üéâ",[
    {text:"OK",class:"btn-primary",onClick:()=>{}}
  ]);
}

deleteDetailBtn.onclick=()=>{
  if(!currentId) return;
  showModal("Xo√° ghi ch√∫ n√†y?",[
    {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
    {text:"Xo√°",class:"btn-danger",onClick:async ()=>{
      await deleteDoc(doc(db,"notes",currentId));
      closeDetail();
    }}
  ]);
};

backBtn.onclick=()=>{
  const changed=
    titleInput.value!==originalTitle ||
    noteInput.value!==originalContent;

  if(changed){
    showModal("B·∫°n c√≥ mu·ªën l∆∞u thay ƒë·ªïi kh√¥ng?",[
      {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
      {text:"Kh√¥ng l∆∞u",class:"btn-danger",onClick:closeDetail},
      {text:"L∆∞u",class:"btn-primary",onClick:async ()=>{
        await saveNote();
        closeDetail();
      }}
    ]);
  }else{
    closeDetail();
  }
};

function openDetail(){
  grid.style.display="none";
  detail.classList.add("active");
}

function closeDetail(){
  detail.classList.remove("active");
  grid.style.display="grid";
}

function autoResize(textarea){
  textarea.style.height = "auto";
  textarea.style.height = textarea.scrollHeight + "px";
}

noteInput.addEventListener("input", () => {
  autoResize(noteInput);
});

saveBtn.onclick=saveNote;
</script>
</body>
</html>
