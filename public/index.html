<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Diary For Kh√°nh Trang</title>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#ffe6f0;
  font-family:'Patrick Hand', cursive;
}

.app{width:100vw;height:100vh;position:relative;overflow:hidden;}
.header{padding:20px 32px;font-size:36px;color:#ff4d94;}

.un-header{
  padding:0 32px 20px 32px; /* gi·ªëng header */
  font-size:20px;
  color:#ff85b3;
  margin-top:-10px;
  letter-spacing:1px;
  font-style:italic;
}

.un-header::before,
.un-header::after{
  content:"";
  position:absolute;
  top:50%;
  width:30%;
  height:1px;
  background:#ffcce6;
}

.un-header::before{left:0;}
.un-header::after{right:0;}

.grid{
  padding:0 32px 32px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:24px;
}

.card{
  height:180px;
  background:white;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(255,105,180,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
  transition:.25s;
  text-align:center;
  padding:10px;
  position:relative;
}
.card:hover{transform:translateY(-6px)}
.card.add{font-size:40px;color:#ff4d94;}

.delete-btn{
  position:absolute;
  top:8px;left:8px;
  background:#ff4d94;color:white;
  border:none;width:26px;height:26px;
  border-radius:50%;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  opacity:0;transition:.2s;
}
.card:hover .delete-btn{opacity:1;}

.detail{
  position:absolute;inset:0;background:#fff;
  padding:32px;opacity:0;transform:scale(.92);
  pointer-events:none;transition:.4s;
}
.detail.active{opacity:1;transform:scale(1);pointer-events:auto;}

.top-actions{display:flex;gap:16px;margin-bottom:20px;}
.back,.delete-text{
  background:none;border:none;
  font-size:20px;color:#ff4d94;cursor:pointer;
}
.delete-text{color:#ff1a75;}

input,textarea{
  width:100%;padding:12px;border-radius:12px;
  border:2px solid #ffd1e8;font-family:inherit;
  font-size:18px;margin-bottom:20px;
}
textarea{min-height:150px;resize:none;}

.save-btn{
  padding:12px 24px;border:none;
  border-radius:999px;background:#ff4d94;
  color:white;font-size:18px;cursor:pointer;
}

/* Popup */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:.3s;
}
.modal.active{opacity:1;pointer-events:auto;}

.modal-box{
  background:white;padding:30px;
  border-radius:20px;width:300px;
  text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.2);
}
.modal-buttons{
  display:flex;justify-content:center;
  gap:12px;margin-top:20px;
}
.modal-buttons button{
  padding:8px 16px;border:none;
  border-radius:999px;cursor:pointer;
  font-family:inherit;
}
.btn-primary{background:#ff4d94;color:white;}
.btn-secondary{background:#ddd;}
.btn-danger{background:#ff1a75;color:white;}
</style>
</head>

<body>
<div class="app">
  <div class="header">üìñ Diary For Kh√°nh Trang</div>
  <div class="un-header">üìñ N∆°i l∆∞u gi·ªØ nh·ªØng d√≤ng k·ªâ ni·ªám hai ta</div>
  <div class="grid" id="grid"></div>

  <div class="detail" id="detail">
    <div class="top-actions">
      <button class="back">‚Üê Back</button>
      <button class="delete-text" id="deleteDetailBtn">Delete</button>
    </div>

    <h2>Title</h2>
    <input id="titleInput">

    <h2>N·ªôi dung</h2>
    <textarea id="noteInput"></textarea>

    <button class="save-btn" id="saveBtn">üíæ Save</button>
  </div>
</div>

<!-- Custom Modal -->
<div class="modal" id="modal">
  <div class="modal-box">
    <div id="modalMessage"></div>
    <div class="modal-buttons" id="modalButtons"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import {
  getFirestore,collection,addDoc,doc,
  updateDoc,deleteDoc,onSnapshot
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"lovechip-14-2.firebaseapp.com",
  projectId:"lovechip-14-2",
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const notesRef=collection(db,"notes");

const grid=document.getElementById("grid");
const detail=document.getElementById("detail");
const titleInput=document.getElementById("titleInput");
const noteInput=document.getElementById("noteInput");
const backBtn=document.querySelector(".back");
const saveBtn=document.getElementById("saveBtn");
const deleteDetailBtn=document.getElementById("deleteDetailBtn");

const modal=document.getElementById("modal");
const modalMessage=document.getElementById("modalMessage");
const modalButtons=document.getElementById("modalButtons");

let currentId=null;
let originalTitle="",originalContent="";

/* -------- Modal Function -------- */
function showModal(message,buttons){
  modalMessage.textContent=message;
  modalButtons.innerHTML="";
  buttons.forEach(btn=>{
    const b=document.createElement("button");
    b.textContent=btn.text;
    b.className=btn.class;
    b.onclick=()=>{modal.classList.remove("active");btn.onClick();}
    modalButtons.appendChild(b);
  });
  modal.classList.add("active");
}

/* -------- Realtime Load -------- */
onSnapshot(notesRef,snapshot=>{
  grid.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const div=document.createElement("div");
    div.className="card";
    div.textContent=data.title||"No Title";

    const del=document.createElement("button");
    del.className="delete-btn";
    del.textContent="√ó";
    del.onclick=(e)=>{
      e.stopPropagation();
      showModal("Xo√° ghi ch√∫ n√†y?",[
        {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
        {text:"Xo√°",class:"btn-danger",onClick:()=>deleteDoc(doc(db,"notes",docSnap.id))}
      ]);
    };
    div.appendChild(del);

    div.onclick=()=>{
      currentId=docSnap.id;
      titleInput.value=data.title||"";
      noteInput.value=data.content||"";
      originalTitle=titleInput.value;
      originalContent=noteInput.value;
      openDetail();
    };
    grid.appendChild(div);
  });

  const add=document.createElement("div");
  add.className="card add";
  add.textContent="+";
  add.onclick=createNote;
  grid.appendChild(add);
});

/* -------- Functions -------- */
async function createNote(){
  const docRef=await addDoc(notesRef,{title:"New Note",content:""});
  currentId=docRef.id;
  titleInput.value="New Note";
  noteInput.value="";
  originalTitle="New Note";
  originalContent="";
  openDetail();
}

async function saveNote(){
  if(!currentId) return;
  await updateDoc(doc(db,"notes",currentId),{
    title:titleInput.value,
    content:noteInput.value
  });
  originalTitle=titleInput.value;
  originalContent=noteInput.value;
  showModal("ƒê√£ l∆∞u th√†nh c√¥ng üéâ",[
    {text:"OK",class:"btn-primary",onClick:()=>{}}
  ]);
}

deleteDetailBtn.onclick=()=>{
  if(!currentId) return;
  showModal("Xo√° ghi ch√∫ n√†y?",[
    {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
    {text:"Xo√°",class:"btn-danger",onClick:async ()=>{
      await deleteDoc(doc(db,"notes",currentId));
      closeDetail();
    }}
  ]);
};

backBtn.onclick=()=>{
  const changed=
    titleInput.value!==originalTitle ||
    noteInput.value!==originalContent;

  if(changed){
    showModal("B·∫°n c√≥ mu·ªën l∆∞u thay ƒë·ªïi kh√¥ng?",[
      {text:"Hu·ª∑",class:"btn-secondary",onClick:()=>{}},
      {text:"Kh√¥ng l∆∞u",class:"btn-danger",onClick:closeDetail},
      {text:"L∆∞u",class:"btn-primary",onClick:async ()=>{
        await saveNote();
        closeDetail();
      }}
    ]);
  }else{
    closeDetail();
  }
};

function openDetail(){
  grid.style.opacity=0;
  detail.classList.add("active");
}

function closeDetail(){
  detail.classList.remove("active");
  grid.style.opacity=1;
}

saveBtn.onclick=saveNote;
</script>
</body>
</html>
